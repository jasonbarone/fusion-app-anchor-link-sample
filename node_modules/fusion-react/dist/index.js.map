{"version":3,"file":"index.js","sources":["../src/async/constants.js","../src/async/prepared.js","../src/async/dispatched.js","../src/async/utils/isReactCompositeComponent.js","../src/async/utils/isReactFunctionalComponent.js","../src/async/prepare.js","../src/async/split.js","../src/async/traverse-exclude.js","../src/async/prepare-provider.js","../src/async/middleware.js","../src/async/index.js","../src/injector.js","../src/server.js","../src/client.js","../src/provider.js","../src/plugin.js","../src/hoc.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport const REACT_PREPARE = '@__REACT_PREPARE__@';\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport {REACT_PREPARE} from './constants';\n\n// $FlowFixMe\nconst prepared = (sideEffect, opts = {}) => OriginalComponent => {\n  opts = Object.assign(\n    {\n      boundary: false,\n      defer: false,\n      componentDidMount: true,\n      componentWillReceiveProps: false,\n      componentDidUpdate: false,\n      contextTypes: {},\n      forceUpdate: false,\n    },\n    opts\n  );\n  const prep = {\n    prepare: (...args) => Promise.resolve(sideEffect(...args)),\n    defer: opts.defer,\n  };\n  // Disable eslint for deprecated componentWillReceiveProps\n  // eslint-disable-next-line react/no-deprecated\n  class PreparedComponent extends React.Component<*, *> {\n    // $FlowFixMe\n    constructor(props, context) {\n      super(props, context);\n      // $FlowFixMe\n      this[REACT_PREPARE] = prep;\n    }\n    componentDidMount() {\n      if (opts.componentDidMount) {\n        Promise.resolve(sideEffect(this.props, this.context)).then(() => {\n          if (opts.forceUpdate) {\n            this.forceUpdate();\n          }\n        });\n      }\n    }\n\n    // $FlowFixMe\n    UNSAFE_componentWillReceiveProps(nextProps, nextContext) {\n      if (opts.componentWillReceiveProps) {\n        sideEffect(nextProps, nextContext);\n      }\n    }\n\n    componentDidUpdate() {\n      if (opts.componentDidUpdate) {\n        sideEffect(this.props, this.context);\n      }\n    }\n\n    render() {\n      return <OriginalComponent {...this.props} />;\n    }\n  }\n\n  const displayName =\n    OriginalComponent.displayName || OriginalComponent.name || '';\n  PreparedComponent.contextTypes = opts.contextTypes;\n  PreparedComponent.displayName = `PreparedComponent(${displayName})`;\n\n  return PreparedComponent;\n};\n\n// $FlowFixMe\nfunction isPrepared(CustomComponent) {\n  return (\n    CustomComponent[REACT_PREPARE] &&\n    typeof CustomComponent[REACT_PREPARE].prepare === 'function'\n  );\n}\n\n// $FlowFixMe\nfunction getPrepare(CustomComponent) {\n  return CustomComponent[REACT_PREPARE] || {};\n}\n\nexport {isPrepared, getPrepare};\nexport default prepared;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport PropTypes from 'prop-types';\n\nimport prepared from './prepared';\n\nconst storeShape = PropTypes.shape({\n  dispatch: PropTypes.func.isRequired,\n});\n\n// $FlowFixMe\nconst dispatched = (prepareUsingDispatch, opts = {}) => OriginalComponent => {\n  const prepare = (props, context) => {\n    return prepareUsingDispatch(props, context.store.dispatch);\n  };\n  const contextTypes = Object.assign(\n    {},\n    opts && opts.contextTypes ? opts.contextTypes : {},\n    {store: storeShape}\n  );\n  const preparedOpts = Object.assign({}, opts, {contextTypes});\n  return prepared(prepare, preparedOpts)(OriginalComponent);\n};\n\nexport default dispatched;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default function isReactCompositeComponent(type: mixed) {\n  if (\n    type != null &&\n    type instanceof Function &&\n    type.prototype != null &&\n    typeof type.prototype.render === 'function'\n  ) {\n    return true;\n  }\n  return false;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default function isReactFunctionalComponent(type: mixed) {\n  if (\n    type instanceof Function &&\n    (type.prototype == null || !type.prototype.render)\n  )\n    return true;\n  return false;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport {\n  isFragment,\n  isContextConsumer,\n  isContextProvider,\n  isForwardRef,\n  isPortal,\n} from 'react-is';\n\nimport isReactCompositeComponent from './utils/isReactCompositeComponent';\nimport isReactFunctionalComponent from './utils/isReactFunctionalComponent';\nimport {isPrepared, getPrepare} from './prepared';\n\nfunction renderCompositeElementInstance(instance) {\n  const childContext = Object.assign(\n    {},\n    instance.context,\n    instance.getChildContext ? instance.getChildContext() : {}\n  );\n\n  if (instance.constructor && instance.constructor.getDerivedStateFromProps) {\n    instance.state = {\n      ...instance.state,\n      ...instance.constructor.getDerivedStateFromProps(\n        instance.props,\n        instance.state\n      ),\n    };\n  } else {\n    // see https://github.com/reactjs/react-lifecycles-compat/blob/0a02b805fcf119128d1a9244e71ea7077e2cdcc0/index.js#L114\n    if (instance.componentWillMount) {\n      instance.componentWillMount();\n    } else if (instance.UNSAFE_componentWillMount) {\n      instance.UNSAFE_componentWillMount();\n    }\n  }\n  const children = instance.render();\n  return [children, childContext];\n}\n\nfunction prepareComponentInstance(instance) {\n  if (!isPrepared(instance)) {\n    return Promise.resolve({});\n  }\n  const prepareConfig = getPrepare(instance);\n  // If the component is deferred, skip the prepare step\n  if (prepareConfig.defer) {\n    return Promise.resolve(prepareConfig);\n  }\n  // $FlowFixMe\n  return prepareConfig.prepare(instance.props, instance.context).then(() => {\n    return prepareConfig;\n  });\n}\n\nfunction prepareElement(element, context) {\n  if (element === null || typeof element !== 'object') {\n    return Promise.resolve([null, context]);\n  }\n  const {type, props} = element;\n  if (isContextConsumer(element)) {\n    return Promise.resolve([props.children(type._currentValue), context]);\n  }\n  if (isContextProvider(element)) {\n    type._context._currentValue = props.value;\n    return Promise.resolve([props.children, context]);\n  }\n  if (\n    typeof type === 'string' ||\n    isFragment(element) ||\n    isForwardRef(element)\n  ) {\n    return Promise.resolve([props.children, context]);\n  } else if (isReactFunctionalComponent(type)) {\n    return Promise.resolve([type(props, context), context]);\n  } else if (isReactCompositeComponent(type)) {\n    const CompositeComponent = type;\n    const instance = new CompositeComponent(props, context);\n    instance.props = props;\n    instance.context = context;\n    return prepareComponentInstance(instance).then(prepareConfig => {\n      // Stop traversing if the component is defer or boundary\n      if (prepareConfig.defer || prepareConfig.boundary) {\n        return Promise.resolve([null, context]);\n      }\n      return renderCompositeElementInstance(instance);\n    });\n  } else if (isPortal(element)) {\n    return Promise.resolve([element.children, context]);\n  } else {\n    throw new TypeError(\n      `Invalid React element type. Must be a string, a function or a subclass of React.Component. ` +\n        `This error happens if you write a React Component <Foo> where Foo is undefined. ` +\n        `This can happen when mistakenly using a default import instead of a named import or vice-versa, ` +\n        `or if you are missing a peerDependency in your package.json and your package manager hoists an older version from an unrelated dependency \\n\\n` +\n        JSON.stringify(element, null, 2)\n    );\n  }\n}\n\nfunction _prepare(element, context) {\n  return prepareElement(element, context).then(([children, childContext]) => {\n    return Promise.all(\n      React.Children.toArray(children).map(child =>\n        _prepare(child, childContext)\n      )\n    );\n  });\n}\n\nfunction prepare(element: any, context: any = {}) {\n  context.__IS_PREPARE__ = true;\n  return _prepare(element, context).then(() => {\n    context.__IS_PREPARE__ = false;\n  });\n}\n\nexport default prepare;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nimport prepared from './prepared.js';\n\nconst CHUNKS_KEY = '__CHUNK_IDS';\n\nconst contextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n};\n\nif (__NODE__) {\n  // $FlowFixMe\n  contextTypes.markAsCritical = PropTypes.func;\n}\n\n// $FlowFixMe\nexport default function withAsyncComponent({\n  defer,\n  load,\n  LoadingComponent,\n  ErrorComponent,\n}) {\n  let AsyncComponent = null;\n  let error = null;\n  let chunkIds = [];\n\n  function WithAsyncComponent(props) {\n    if (error) {\n      return <ErrorComponent error={error} />;\n    }\n    if (!AsyncComponent) {\n      return <LoadingComponent />;\n    }\n    return <AsyncComponent {...props} />;\n  }\n  return prepared(\n    (props, context) => {\n      if (AsyncComponent) {\n        if (__NODE__ && context.markAsCritical) {\n          chunkIds.forEach(chunkId => {\n            context.markAsCritical(chunkId);\n          });\n        }\n        return Promise.resolve(AsyncComponent);\n      }\n\n      let componentPromise;\n      try {\n        componentPromise = load();\n      } catch (e) {\n        componentPromise = Promise.reject(e);\n      }\n      // $FlowFixMe\n      chunkIds = componentPromise[CHUNKS_KEY] || [];\n\n      if (__NODE__ && context.markAsCritical) {\n        chunkIds.forEach(chunkId => {\n          context.markAsCritical(chunkId);\n        });\n      }\n\n      const loadPromises = [\n        componentPromise,\n        ...context.splitComponentLoaders.map(loader => loader(chunkIds)),\n      ];\n\n      return Promise.all(loadPromises)\n        .then(([asyncComponent]) => {\n          // Note: .default is toolchain specific, breaks w/ CommonJS exports\n          AsyncComponent = asyncComponent.default;\n          if (AsyncComponent === undefined) {\n            throw new Error('Bundle does not contain a default export');\n          }\n        })\n        .catch(err => {\n          error = err;\n          if (__BROWSER__)\n            setTimeout(() => {\n              throw err;\n            }); // log error\n        });\n    },\n    {defer, contextTypes, forceUpdate: true}\n  )(WithAsyncComponent);\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport prepared from './prepared.js';\n\n// Stops the traversal at this node. Useful for optimizing the prepare traversal\n// to visit the minimum number of nodes\nexport default prepared(Promise.resolve(), {\n  componentDidMount: false,\n  componentWillReceiveProps: false,\n  componentDidUpdate: false,\n  defer: true,\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nclass PrepareProvider extends React.Component<*, *> {\n  constructor(props: any, context: any) {\n    super(props, context);\n    this.splitComponentLoaders = [];\n    this.markAsCritical = props.markAsCritical;\n  }\n\n  splitComponentLoaders: Array<any>;\n  markAsCritical: number => void;\n\n  getChildContext() {\n    return {\n      splitComponentLoaders: this.splitComponentLoaders,\n      markAsCritical: this.markAsCritical,\n    };\n  }\n  render() {\n    return React.Children.only(this.props.children);\n  }\n}\n\nPrepareProvider.childContextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n  markAsCritical: PropTypes.func,\n};\n\nexport default PrepareProvider;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport type {Middleware} from 'fusion-core';\n\nimport PrepareProvider from './prepare-provider';\n\nconst middleware: Middleware = function(ctx, next) {\n  if (__DEV__) {\n    // eslint-disable-next-line no-console\n    console.warn('The {middleware} export from fusion-react is deprecated.');\n  }\n\n  if (__NODE__ && !ctx.element) {\n    return next();\n  }\n\n  const markAsCritical = __NODE__\n    ? chunkId => {\n        // Push to legacy context for backwards compat w/ legacy SSR template\n        ctx.preloadChunks.push(chunkId);\n      }\n    : noop;\n  ctx.element = (\n    <PrepareProvider markAsCritical={markAsCritical}>\n      {ctx.element}\n    </PrepareProvider>\n  );\n  return next();\n};\n\nexport default middleware;\n\nfunction noop() {}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport dispatched from './dispatched';\nimport prepare from './prepare';\nimport prepared from './prepared';\nimport split from './split';\nimport exclude from './traverse-exclude';\nimport middleware from './middleware';\n\nconst prepareTyped: (\n  element: React.Element<any>\n  // $FlowFixMe\n) => Promise<React.ComponentType<any>> = prepare;\n\nconst preparedTyped: (\n  sideEffect: (props: Object, context: Object) => Promise<any> | any,\n  opts?: {\n    defer?: boolean,\n    boundary?: boolean,\n    componentDidMount?: boolean,\n    componentWillReceiveProps?: boolean,\n    componentDidUpdate?: boolean,\n    forceUpdate?: boolean,\n    contextTypes?: Object,\n  }\n) => (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = prepared;\n\nconst splitTyped: (opts: {\n  load: () => Promise<any>,\n  LoadingComponent: React.ComponentType<any>,\n  ErrorComponent: React.ComponentType<any>,\n}) => React.ComponentType<any> = split;\n\nconst excludeTyped: (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = exclude;\n\nexport {\n  dispatched,\n  prepareTyped as prepare,\n  preparedTyped as prepared,\n  splitTyped as split,\n  excludeTyped as exclude,\n  middleware,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport FusionApp, {createPlugin} from 'fusion-core';\nimport PropTypes from 'prop-types';\n\ntype Dependencies = {[string]: any};\ntype Services = {[string]: any};\ntype Props = {[string]: any};\ntype Mapper = Services => Props;\n\n// React.createContext ponyfill\nfunction createContext(value) {\n  if ('createContext' in React) {\n    return React.createContext<(Dependencies) => Services>(value);\n  }\n\n  const key = `_fusionContextPonyfill${Math.random()}`;\n\n  class Provider extends React.Component<*> {\n    getChildContext() {\n      return {[key]: this.props.value || value};\n    }\n\n    render() {\n      return this.props.children;\n    }\n  }\n\n  Provider.childContextTypes = {\n    [key]: PropTypes.any.isRequired,\n  };\n\n  function Consumer(props: *, context: *) {\n    return props.children(context[key]);\n  }\n\n  Consumer.contextTypes = {\n    [key]: PropTypes.any.isRequired,\n  };\n\n  return {\n    Provider,\n    Consumer,\n  };\n}\n\nlet InjectorContext;\n\nfunction getServices(app: FusionApp, deps: Dependencies): Services {\n  const services = {};\n\n  Object.entries(deps).forEach(([name, token]) => {\n    // To be addressed in a future Flow-focued PR.\n    // $FlowFixMe\n    services[name] = app.getService(token);\n  });\n\n  return services;\n}\n\n// istanbul ignore next\nfunction defaultInject(deps: Dependencies): Services {\n  return {};\n}\n\nfunction defaultMap(services: Services): Props {\n  return services;\n}\n\nexport function registerInjector(app: FusionApp) {\n  // Lazily create context for easier testing\n  InjectorContext = createContext(defaultInject);\n\n  function inject(deps: Dependencies): Services {\n    return getServices(app, deps);\n  }\n\n  function renderProvider(children) {\n    return (\n      <InjectorContext.Provider value={inject}>\n        {children}\n      </InjectorContext.Provider>\n    );\n  }\n\n  const injectorPlugin = createPlugin({\n    middleware: () => (ctx, next) => {\n      ctx.element = ctx.element && renderProvider(ctx.element);\n\n      return next();\n    },\n  });\n\n  app.register(injectorPlugin);\n}\n\nexport function withServices(\n  deps: Dependencies,\n  mapServicesToProps: Mapper = defaultMap\n) {\n  function resolve(inject, props) {\n    const services = inject(deps);\n    const serviceProps = mapServicesToProps(services);\n\n    return {\n      ...serviceProps,\n      ...props,\n    };\n  }\n\n  function renderConsumer(Component, props) {\n    return (\n      <InjectorContext.Consumer>\n        {inject => <Component {...resolve(inject, props)} />}\n      </InjectorContext.Consumer>\n    );\n  }\n\n  return (Component: React.ComponentType<*>) => {\n    return function WithServices(props: *) {\n      return renderConsumer(Component, props);\n    };\n  };\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport * as React from 'react';\nimport {renderToString} from 'react-dom/server';\n\nexport default (el: React.Element<*>) =>\n  `<div id='root'>${renderToString(el)}</div>`;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport default (el: React.Element<*>) => {\n  const domElement = document.getElementById('root');\n\n  if (!domElement) {\n    throw new Error(\"Could not find 'root' element\");\n  }\n\n  return ReactDOM.hydrate\n    ? ReactDOM.hydrate(el, domElement)\n    : ReactDOM.render(el, domElement);\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nexport default {\n  create: (name: string) => {\n    class Provider extends React.Component<*> {\n      getChildContext() {\n        return {[name]: this.props.provides};\n      }\n      render() {\n        return React.Children.only(this.props.children);\n      }\n    }\n    Provider.childContextTypes = {\n      ...(Provider.childContextTypes || {}),\n      [name]: PropTypes.any.isRequired,\n    };\n    Provider.displayName =\n      name.replace(/^./, c => c.toUpperCase()) + 'Provider';\n\n    return Provider;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin, Middleware} from 'fusion-core';\n\nimport Provider from './provider';\n\n// eslint-disable-next-line\ntype FusionPluginNoHidden<TDeps, TService> = $Diff<\n  FusionPlugin<TDeps, TService>,\n  {__plugin__: boolean, stack: string}\n>;\n\nexport default {\n  create: <TDeps: *, TService: *>(\n    name: string,\n    // eslint-disable-next-line\n    plugin:\n      | FusionPluginNoHidden<TDeps, TService>\n      | FusionPlugin<TDeps, TService>,\n    provider?: React.ComponentType<*>\n  ): FusionPlugin<TDeps, TService> => {\n    if (plugin.__plugin__ === undefined) {\n      plugin = createPlugin(plugin);\n    }\n    if (!plugin.__plugin__) {\n      throw new Error(\n        'Provided plugin does not match FusionPlugin<TDeps, TService>'\n      );\n    }\n\n    let originalMiddleware = plugin.middleware;\n    const ProviderComponent = provider || Provider.create(name);\n    plugin.middleware = (deps: *, provides: *) => {\n      let nextMiddleware =\n        originalMiddleware && originalMiddleware(deps, provides);\n      const mw: Middleware = function(ctx, next) {\n        if (ctx.element) {\n          ctx.element = React.createElement(\n            ProviderComponent,\n            {provides, ctx},\n            ctx.element\n          );\n        }\n        if (nextMiddleware) {\n          return nextMiddleware(ctx, next);\n        }\n        return next();\n      };\n      return mw;\n    };\n    return plugin;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport PropTypes from 'prop-types';\n\ntype ReactHOC = (React.ComponentType<*>) => React.ComponentType<*>;\nexport default {\n  create: (name: string, mapProvidesToProps?: Object => Object): ReactHOC => {\n    const mapProvides = mapProvidesToProps\n      ? mapProvidesToProps\n      : provides => ({[name]: provides});\n    return (Component: React.ComponentType<*>) => {\n      class HOC extends React.Component<*> {\n        provides: any;\n\n        constructor(props: *, ctx: *) {\n          super(props, ctx);\n          this.provides = ctx[name];\n        }\n        render() {\n          const props = {...this.props, ...mapProvides(this.provides)};\n          return React.createElement(Component, props);\n        }\n      }\n      const displayName =\n        Component.displayName || Component.name || 'Anonymous';\n      HOC.displayName =\n        'With' +\n        name.replace(/^./, c => c.toUpperCase()) +\n        '(' +\n        displayName +\n        ')';\n      HOC.contextTypes = {\n        [name]: PropTypes.any.isRequired,\n      };\n      return HOC;\n    };\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\n\nimport FusionApp, {createPlugin, CriticalChunkIdsToken} from 'fusion-core';\nimport {prepare} from './async/index.js';\nimport PrepareProvider from './async/prepare-provider';\nimport {registerInjector, withServices} from './injector.js';\n\nimport serverRender from './server';\nimport clientRender from './client';\n\nimport ProviderPlugin from './plugin';\nimport ProvidedHOC from './hoc';\nimport Provider from './provider';\n\ndeclare var __NODE__: Boolean;\n\nexport default class App extends FusionApp {\n  constructor(root: React.Element<*>, render: ?(React.Element<*>) => any) {\n    if (!React.isValidElement(root))\n      throw new Error(\n        'Invalid React element. Ensure your root element is a React.Element (e.g. <Foo />) and not a React.Component (e.g. Foo)'\n      );\n    const renderer = createPlugin({\n      deps: {\n        criticalChunkIds: CriticalChunkIdsToken.optional,\n      },\n      provides() {\n        return (el: React.Element<*>) => {\n          return prepare(el).then(() => {\n            if (render) {\n              return render(el);\n            }\n            return __NODE__ ? serverRender(el) : clientRender(el);\n          });\n        };\n      },\n      middleware({criticalChunkIds}) {\n        return (ctx, next) => {\n          if (__NODE__ && !ctx.element) {\n            return next();\n          }\n\n          const markAsCritical = __NODE__\n            ? chunkId => {\n                // Push to legacy context for backwards compat w/ legacy SSR template\n                ctx.preloadChunks.push(chunkId);\n\n                // Also use new service if registered\n                if (criticalChunkIds) {\n                  let chunkIds = criticalChunkIds.from(ctx);\n                  chunkIds.add(chunkId);\n                }\n              }\n            : noop;\n          ctx.element = (\n            <PrepareProvider markAsCritical={markAsCritical}>\n              {ctx.element}\n            </PrepareProvider>\n          );\n          return next();\n        };\n      },\n    });\n    super(root, renderer);\n    registerInjector(this);\n  }\n}\n\nexport {ProviderPlugin, ProvidedHOC, Provider, withServices};\n\nfunction noop() {}\n\nexport * from './async/index.js';\n"],"names":["REACT_PREPARE","prepared","sideEffect","opts","OriginalComponent","Object","assign","boundary","defer","componentDidMount","componentWillReceiveProps","componentDidUpdate","contextTypes","forceUpdate","prep","prepare","args","Promise","resolve","PreparedComponent","React","constructor","props","context","then","UNSAFE_componentWillReceiveProps","nextProps","nextContext","render","React.createElement","displayName","name","isPrepared","CustomComponent","getPrepare","storeShape","PropTypes","shape","dispatch","func","isRequired","dispatched","prepareUsingDispatch","store","preparedOpts","isReactCompositeComponent","type","Function","prototype","isReactFunctionalComponent","renderCompositeElementInstance","instance","childContext","getChildContext","getDerivedStateFromProps","state","componentWillMount","UNSAFE_componentWillMount","children","prepareComponentInstance","prepareConfig","prepareElement","element","isContextConsumer","_currentValue","isContextProvider","_context","value","isFragment","isForwardRef","CompositeComponent","isPortal","TypeError","JSON","stringify","_prepare","all","toArray","map","child","__IS_PREPARE__","CHUNKS_KEY","splitComponentLoaders","array","markAsCritical","withAsyncComponent","load","LoadingComponent","ErrorComponent","AsyncComponent","error","chunkIds","WithAsyncComponent","forEach","chunkId","componentPromise","e","reject","loadPromises","loader","asyncComponent","default","undefined","Error","catch","err","PrepareProvider","only","childContextTypes","middleware","ctx","next","console","warn","preloadChunks","push","prepareTyped","preparedTyped","splitTyped","split","excludeTyped","exclude","createContext","key","Math","random","Provider","any","Consumer","InjectorContext","getServices","app","deps","services","entries","token","getService","defaultInject","defaultMap","registerInjector","inject","renderProvider","injectorPlugin","createPlugin","register","withServices","mapServicesToProps","serviceProps","renderConsumer","Component","WithServices","el","renderToString","create","provides","replace","c","toUpperCase","plugin","provider","__plugin__","originalMiddleware","ProviderComponent","nextMiddleware","mw","mapProvidesToProps","mapProvides","HOC","App","FusionApp","root","renderer","criticalChunkIds","CriticalChunkIdsToken","optional","serverRender","from","add"],"mappings":"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"}