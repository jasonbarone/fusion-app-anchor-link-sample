{"version":3,"file":"browser.es5.js","sources":["../src/async/constants.js","../src/async/prepared.js","../src/async/dispatched.js","../src/async/utils/isReactCompositeComponent.js","../src/async/utils/isReactFunctionalComponent.js","../src/async/prepare.js","../src/async/split.js","../src/async/traverse-exclude.js","../src/async/prepare-provider.js","../src/async/middleware.js","../src/async/index.js","../src/injector.js","../src/server.js","../src/client.js","../src/provider.js","../src/plugin.js","../src/hoc.js","../src/index.js"],"sourcesContent":["/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport const REACT_PREPARE = '@__REACT_PREPARE__@';\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport {REACT_PREPARE} from './constants';\n\n// $FlowFixMe\nconst prepared = (sideEffect, opts = {}) => OriginalComponent => {\n  opts = Object.assign(\n    {\n      boundary: false,\n      defer: false,\n      componentDidMount: true,\n      componentWillReceiveProps: false,\n      componentDidUpdate: false,\n      contextTypes: {},\n      forceUpdate: false,\n    },\n    opts\n  );\n  const prep = {\n    prepare: (...args) => Promise.resolve(sideEffect(...args)),\n    defer: opts.defer,\n  };\n  // Disable eslint for deprecated componentWillReceiveProps\n  // eslint-disable-next-line react/no-deprecated\n  class PreparedComponent extends React.Component<*, *> {\n    // $FlowFixMe\n    constructor(props, context) {\n      super(props, context);\n      // $FlowFixMe\n      this[REACT_PREPARE] = prep;\n    }\n    componentDidMount() {\n      if (opts.componentDidMount) {\n        Promise.resolve(sideEffect(this.props, this.context)).then(() => {\n          if (opts.forceUpdate) {\n            this.forceUpdate();\n          }\n        });\n      }\n    }\n\n    // $FlowFixMe\n    UNSAFE_componentWillReceiveProps(nextProps, nextContext) {\n      if (opts.componentWillReceiveProps) {\n        sideEffect(nextProps, nextContext);\n      }\n    }\n\n    componentDidUpdate() {\n      if (opts.componentDidUpdate) {\n        sideEffect(this.props, this.context);\n      }\n    }\n\n    render() {\n      return <OriginalComponent {...this.props} />;\n    }\n  }\n\n  const displayName =\n    OriginalComponent.displayName || OriginalComponent.name || '';\n  PreparedComponent.contextTypes = opts.contextTypes;\n  PreparedComponent.displayName = `PreparedComponent(${displayName})`;\n\n  return PreparedComponent;\n};\n\n// $FlowFixMe\nfunction isPrepared(CustomComponent) {\n  return (\n    CustomComponent[REACT_PREPARE] &&\n    typeof CustomComponent[REACT_PREPARE].prepare === 'function'\n  );\n}\n\n// $FlowFixMe\nfunction getPrepare(CustomComponent) {\n  return CustomComponent[REACT_PREPARE] || {};\n}\n\nexport {isPrepared, getPrepare};\nexport default prepared;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport PropTypes from 'prop-types';\n\nimport prepared from './prepared';\n\nconst storeShape = PropTypes.shape({\n  dispatch: PropTypes.func.isRequired,\n});\n\n// $FlowFixMe\nconst dispatched = (prepareUsingDispatch, opts = {}) => OriginalComponent => {\n  const prepare = (props, context) => {\n    return prepareUsingDispatch(props, context.store.dispatch);\n  };\n  const contextTypes = Object.assign(\n    {},\n    opts && opts.contextTypes ? opts.contextTypes : {},\n    {store: storeShape}\n  );\n  const preparedOpts = Object.assign({}, opts, {contextTypes});\n  return prepared(prepare, preparedOpts)(OriginalComponent);\n};\n\nexport default dispatched;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default function isReactCompositeComponent(type: mixed) {\n  if (\n    type != null &&\n    type instanceof Function &&\n    type.prototype != null &&\n    typeof type.prototype.render === 'function'\n  ) {\n    return true;\n  }\n  return false;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nexport default function isReactFunctionalComponent(type: mixed) {\n  if (\n    type instanceof Function &&\n    (type.prototype == null || !type.prototype.render)\n  )\n    return true;\n  return false;\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport {\n  isFragment,\n  isContextConsumer,\n  isContextProvider,\n  isForwardRef,\n  isPortal,\n} from 'react-is';\n\nimport isReactCompositeComponent from './utils/isReactCompositeComponent';\nimport isReactFunctionalComponent from './utils/isReactFunctionalComponent';\nimport {isPrepared, getPrepare} from './prepared';\n\nfunction renderCompositeElementInstance(instance) {\n  const childContext = Object.assign(\n    {},\n    instance.context,\n    instance.getChildContext ? instance.getChildContext() : {}\n  );\n\n  if (instance.constructor && instance.constructor.getDerivedStateFromProps) {\n    instance.state = {\n      ...instance.state,\n      ...instance.constructor.getDerivedStateFromProps(\n        instance.props,\n        instance.state\n      ),\n    };\n  } else {\n    // see https://github.com/reactjs/react-lifecycles-compat/blob/0a02b805fcf119128d1a9244e71ea7077e2cdcc0/index.js#L114\n    if (instance.componentWillMount) {\n      instance.componentWillMount();\n    } else if (instance.UNSAFE_componentWillMount) {\n      instance.UNSAFE_componentWillMount();\n    }\n  }\n  const children = instance.render();\n  return [children, childContext];\n}\n\nfunction prepareComponentInstance(instance) {\n  if (!isPrepared(instance)) {\n    return Promise.resolve({});\n  }\n  const prepareConfig = getPrepare(instance);\n  // If the component is deferred, skip the prepare step\n  if (prepareConfig.defer) {\n    return Promise.resolve(prepareConfig);\n  }\n  // $FlowFixMe\n  return prepareConfig.prepare(instance.props, instance.context).then(() => {\n    return prepareConfig;\n  });\n}\n\nfunction prepareElement(element, context) {\n  if (element === null || typeof element !== 'object') {\n    return Promise.resolve([null, context]);\n  }\n  const {type, props} = element;\n  if (isContextConsumer(element)) {\n    return Promise.resolve([props.children(type._currentValue), context]);\n  }\n  if (isContextProvider(element)) {\n    type._context._currentValue = props.value;\n    return Promise.resolve([props.children, context]);\n  }\n  if (\n    typeof type === 'string' ||\n    isFragment(element) ||\n    isForwardRef(element)\n  ) {\n    return Promise.resolve([props.children, context]);\n  } else if (isReactFunctionalComponent(type)) {\n    return Promise.resolve([type(props, context), context]);\n  } else if (isReactCompositeComponent(type)) {\n    const CompositeComponent = type;\n    const instance = new CompositeComponent(props, context);\n    instance.props = props;\n    instance.context = context;\n    return prepareComponentInstance(instance).then(prepareConfig => {\n      // Stop traversing if the component is defer or boundary\n      if (prepareConfig.defer || prepareConfig.boundary) {\n        return Promise.resolve([null, context]);\n      }\n      return renderCompositeElementInstance(instance);\n    });\n  } else if (isPortal(element)) {\n    return Promise.resolve([element.children, context]);\n  } else {\n    throw new TypeError(\n      `Invalid React element type. Must be a string, a function or a subclass of React.Component. ` +\n        `This error happens if you write a React Component <Foo> where Foo is undefined. ` +\n        `This can happen when mistakenly using a default import instead of a named import or vice-versa, ` +\n        `or if you are missing a peerDependency in your package.json and your package manager hoists an older version from an unrelated dependency \\n\\n` +\n        JSON.stringify(element, null, 2)\n    );\n  }\n}\n\nfunction _prepare(element, context) {\n  return prepareElement(element, context).then(([children, childContext]) => {\n    return Promise.all(\n      React.Children.toArray(children).map(child =>\n        _prepare(child, childContext)\n      )\n    );\n  });\n}\n\nfunction prepare(element: any, context: any = {}) {\n  context.__IS_PREPARE__ = true;\n  return _prepare(element, context).then(() => {\n    context.__IS_PREPARE__ = false;\n  });\n}\n\nexport default prepare;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nimport prepared from './prepared.js';\n\nconst CHUNKS_KEY = '__CHUNK_IDS';\n\nconst contextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n};\n\nif (__NODE__) {\n  // $FlowFixMe\n  contextTypes.markAsCritical = PropTypes.func;\n}\n\n// $FlowFixMe\nexport default function withAsyncComponent({\n  defer,\n  load,\n  LoadingComponent,\n  ErrorComponent,\n}) {\n  let AsyncComponent = null;\n  let error = null;\n  let chunkIds = [];\n\n  function WithAsyncComponent(props) {\n    if (error) {\n      return <ErrorComponent error={error} />;\n    }\n    if (!AsyncComponent) {\n      return <LoadingComponent />;\n    }\n    return <AsyncComponent {...props} />;\n  }\n  return prepared(\n    (props, context) => {\n      if (AsyncComponent) {\n        if (__NODE__ && context.markAsCritical) {\n          chunkIds.forEach(chunkId => {\n            context.markAsCritical(chunkId);\n          });\n        }\n        return Promise.resolve(AsyncComponent);\n      }\n\n      let componentPromise;\n      try {\n        componentPromise = load();\n      } catch (e) {\n        componentPromise = Promise.reject(e);\n      }\n      // $FlowFixMe\n      chunkIds = componentPromise[CHUNKS_KEY] || [];\n\n      if (__NODE__ && context.markAsCritical) {\n        chunkIds.forEach(chunkId => {\n          context.markAsCritical(chunkId);\n        });\n      }\n\n      const loadPromises = [\n        componentPromise,\n        ...context.splitComponentLoaders.map(loader => loader(chunkIds)),\n      ];\n\n      return Promise.all(loadPromises)\n        .then(([asyncComponent]) => {\n          // Note: .default is toolchain specific, breaks w/ CommonJS exports\n          AsyncComponent = asyncComponent.default;\n          if (AsyncComponent === undefined) {\n            throw new Error('Bundle does not contain a default export');\n          }\n        })\n        .catch(err => {\n          error = err;\n          if (__BROWSER__)\n            setTimeout(() => {\n              throw err;\n            }); // log error\n        });\n    },\n    {defer, contextTypes, forceUpdate: true}\n  )(WithAsyncComponent);\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport prepared from './prepared.js';\n\n// Stops the traversal at this node. Useful for optimizing the prepare traversal\n// to visit the minimum number of nodes\nexport default prepared(Promise.resolve(), {\n  componentDidMount: false,\n  componentWillReceiveProps: false,\n  componentDidUpdate: false,\n  defer: true,\n});\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nclass PrepareProvider extends React.Component<*, *> {\n  constructor(props: any, context: any) {\n    super(props, context);\n    this.splitComponentLoaders = [];\n    this.markAsCritical = props.markAsCritical;\n  }\n\n  splitComponentLoaders: Array<any>;\n  markAsCritical: number => void;\n\n  getChildContext() {\n    return {\n      splitComponentLoaders: this.splitComponentLoaders,\n      markAsCritical: this.markAsCritical,\n    };\n  }\n  render() {\n    return React.Children.only(this.props.children);\n  }\n}\n\nPrepareProvider.childContextTypes = {\n  splitComponentLoaders: PropTypes.array.isRequired,\n  markAsCritical: PropTypes.func,\n};\n\nexport default PrepareProvider;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport type {Middleware} from 'fusion-core';\n\nimport PrepareProvider from './prepare-provider';\n\nconst middleware: Middleware = function(ctx, next) {\n  if (__DEV__) {\n    // eslint-disable-next-line no-console\n    console.warn('The {middleware} export from fusion-react is deprecated.');\n  }\n\n  if (__NODE__ && !ctx.element) {\n    return next();\n  }\n\n  const markAsCritical = __NODE__\n    ? chunkId => {\n        // Push to legacy context for backwards compat w/ legacy SSR template\n        ctx.preloadChunks.push(chunkId);\n      }\n    : noop;\n  ctx.element = (\n    <PrepareProvider markAsCritical={markAsCritical}>\n      {ctx.element}\n    </PrepareProvider>\n  );\n  return next();\n};\n\nexport default middleware;\n\nfunction noop() {}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport dispatched from './dispatched';\nimport prepare from './prepare';\nimport prepared from './prepared';\nimport split from './split';\nimport exclude from './traverse-exclude';\nimport middleware from './middleware';\n\nconst prepareTyped: (\n  element: React.Element<any>\n  // $FlowFixMe\n) => Promise<React.ComponentType<any>> = prepare;\n\nconst preparedTyped: (\n  sideEffect: (props: Object, context: Object) => Promise<any> | any,\n  opts?: {\n    defer?: boolean,\n    boundary?: boolean,\n    componentDidMount?: boolean,\n    componentWillReceiveProps?: boolean,\n    componentDidUpdate?: boolean,\n    forceUpdate?: boolean,\n    contextTypes?: Object,\n  }\n) => (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = prepared;\n\nconst splitTyped: (opts: {\n  load: () => Promise<any>,\n  LoadingComponent: React.ComponentType<any>,\n  ErrorComponent: React.ComponentType<any>,\n}) => React.ComponentType<any> = split;\n\nconst excludeTyped: (\n  Component: React.ComponentType<any>\n) => React.ComponentType<any> = exclude;\n\nexport {\n  dispatched,\n  prepareTyped as prepare,\n  preparedTyped as prepared,\n  splitTyped as split,\n  excludeTyped as exclude,\n  middleware,\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport FusionApp, {createPlugin} from 'fusion-core';\nimport PropTypes from 'prop-types';\n\ntype Dependencies = {[string]: any};\ntype Services = {[string]: any};\ntype Props = {[string]: any};\ntype Mapper = Services => Props;\n\n// React.createContext ponyfill\nfunction createContext(value) {\n  if ('createContext' in React) {\n    return React.createContext<(Dependencies) => Services>(value);\n  }\n\n  const key = `_fusionContextPonyfill${Math.random()}`;\n\n  class Provider extends React.Component<*> {\n    getChildContext() {\n      return {[key]: this.props.value || value};\n    }\n\n    render() {\n      return this.props.children;\n    }\n  }\n\n  Provider.childContextTypes = {\n    [key]: PropTypes.any.isRequired,\n  };\n\n  function Consumer(props: *, context: *) {\n    return props.children(context[key]);\n  }\n\n  Consumer.contextTypes = {\n    [key]: PropTypes.any.isRequired,\n  };\n\n  return {\n    Provider,\n    Consumer,\n  };\n}\n\nlet InjectorContext;\n\nfunction getServices(app: FusionApp, deps: Dependencies): Services {\n  const services = {};\n\n  Object.entries(deps).forEach(([name, token]) => {\n    // To be addressed in a future Flow-focued PR.\n    // $FlowFixMe\n    services[name] = app.getService(token);\n  });\n\n  return services;\n}\n\n// istanbul ignore next\nfunction defaultInject(deps: Dependencies): Services {\n  return {};\n}\n\nfunction defaultMap(services: Services): Props {\n  return services;\n}\n\nexport function registerInjector(app: FusionApp) {\n  // Lazily create context for easier testing\n  InjectorContext = createContext(defaultInject);\n\n  function inject(deps: Dependencies): Services {\n    return getServices(app, deps);\n  }\n\n  function renderProvider(children) {\n    return (\n      <InjectorContext.Provider value={inject}>\n        {children}\n      </InjectorContext.Provider>\n    );\n  }\n\n  const injectorPlugin = createPlugin({\n    middleware: () => (ctx, next) => {\n      ctx.element = ctx.element && renderProvider(ctx.element);\n\n      return next();\n    },\n  });\n\n  app.register(injectorPlugin);\n}\n\nexport function withServices(\n  deps: Dependencies,\n  mapServicesToProps: Mapper = defaultMap\n) {\n  function resolve(inject, props) {\n    const services = inject(deps);\n    const serviceProps = mapServicesToProps(services);\n\n    return {\n      ...serviceProps,\n      ...props,\n    };\n  }\n\n  function renderConsumer(Component, props) {\n    return (\n      <InjectorContext.Consumer>\n        {inject => <Component {...resolve(inject, props)} />}\n      </InjectorContext.Consumer>\n    );\n  }\n\n  return (Component: React.ComponentType<*>) => {\n    return function WithServices(props: *) {\n      return renderConsumer(Component, props);\n    };\n  };\n}\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env node */\nimport * as React from 'react';\nimport {renderToString} from 'react-dom/server';\n\nexport default (el: React.Element<*>) =>\n  `<div id='root'>${renderToString(el)}</div>`;\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport default (el: React.Element<*>) => {\n  const domElement = document.getElementById('root');\n\n  if (!domElement) {\n    throw new Error(\"Could not find 'root' element\");\n  }\n\n  return ReactDOM.hydrate\n    ? ReactDOM.hydrate(el, domElement)\n    : ReactDOM.render(el, domElement);\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\n\nexport default {\n  create: (name: string) => {\n    class Provider extends React.Component<*> {\n      getChildContext() {\n        return {[name]: this.props.provides};\n      }\n      render() {\n        return React.Children.only(this.props.children);\n      }\n    }\n    Provider.childContextTypes = {\n      ...(Provider.childContextTypes || {}),\n      [name]: PropTypes.any.isRequired,\n    };\n    Provider.displayName =\n      name.replace(/^./, c => c.toUpperCase()) + 'Provider';\n\n    return Provider;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport {createPlugin} from 'fusion-core';\nimport type {FusionPlugin, Middleware} from 'fusion-core';\n\nimport Provider from './provider';\n\n// eslint-disable-next-line\ntype FusionPluginNoHidden<TDeps, TService> = $Diff<\n  FusionPlugin<TDeps, TService>,\n  {__plugin__: boolean, stack: string}\n>;\n\nexport default {\n  create: <TDeps: *, TService: *>(\n    name: string,\n    // eslint-disable-next-line\n    plugin:\n      | FusionPluginNoHidden<TDeps, TService>\n      | FusionPlugin<TDeps, TService>,\n    provider?: React.ComponentType<*>\n  ): FusionPlugin<TDeps, TService> => {\n    if (plugin.__plugin__ === undefined) {\n      plugin = createPlugin(plugin);\n    }\n    if (!plugin.__plugin__) {\n      throw new Error(\n        'Provided plugin does not match FusionPlugin<TDeps, TService>'\n      );\n    }\n\n    let originalMiddleware = plugin.middleware;\n    const ProviderComponent = provider || Provider.create(name);\n    plugin.middleware = (deps: *, provides: *) => {\n      let nextMiddleware =\n        originalMiddleware && originalMiddleware(deps, provides);\n      const mw: Middleware = function(ctx, next) {\n        if (ctx.element) {\n          ctx.element = React.createElement(\n            ProviderComponent,\n            {provides, ctx},\n            ctx.element\n          );\n        }\n        if (nextMiddleware) {\n          return nextMiddleware(ctx, next);\n        }\n        return next();\n      };\n      return mw;\n    };\n    return plugin;\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport * as React from 'react';\n\nimport PropTypes from 'prop-types';\n\ntype ReactHOC = (React.ComponentType<*>) => React.ComponentType<*>;\nexport default {\n  create: (name: string, mapProvidesToProps?: Object => Object): ReactHOC => {\n    const mapProvides = mapProvidesToProps\n      ? mapProvidesToProps\n      : provides => ({[name]: provides});\n    return (Component: React.ComponentType<*>) => {\n      class HOC extends React.Component<*> {\n        provides: any;\n\n        constructor(props: *, ctx: *) {\n          super(props, ctx);\n          this.provides = ctx[name];\n        }\n        render() {\n          const props = {...this.props, ...mapProvides(this.provides)};\n          return React.createElement(Component, props);\n        }\n      }\n      const displayName =\n        Component.displayName || Component.name || 'Anonymous';\n      HOC.displayName =\n        'With' +\n        name.replace(/^./, c => c.toUpperCase()) +\n        '(' +\n        displayName +\n        ')';\n      HOC.contextTypes = {\n        [name]: PropTypes.any.isRequired,\n      };\n      return HOC;\n    };\n  },\n};\n","/** Copyright (c) 2018 Uber Technologies, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-env browser */\nimport * as React from 'react';\n\nimport FusionApp, {createPlugin, CriticalChunkIdsToken} from 'fusion-core';\nimport {prepare} from './async/index.js';\nimport PrepareProvider from './async/prepare-provider';\nimport {registerInjector, withServices} from './injector.js';\n\nimport serverRender from './server';\nimport clientRender from './client';\n\nimport ProviderPlugin from './plugin';\nimport ProvidedHOC from './hoc';\nimport Provider from './provider';\n\ndeclare var __NODE__: Boolean;\n\nexport default class App extends FusionApp {\n  constructor(root: React.Element<*>, render: ?(React.Element<*>) => any) {\n    if (!React.isValidElement(root))\n      throw new Error(\n        'Invalid React element. Ensure your root element is a React.Element (e.g. <Foo />) and not a React.Component (e.g. Foo)'\n      );\n    const renderer = createPlugin({\n      deps: {\n        criticalChunkIds: CriticalChunkIdsToken.optional,\n      },\n      provides() {\n        return (el: React.Element<*>) => {\n          return prepare(el).then(() => {\n            if (render) {\n              return render(el);\n            }\n            return __NODE__ ? serverRender(el) : clientRender(el);\n          });\n        };\n      },\n      middleware({criticalChunkIds}) {\n        return (ctx, next) => {\n          if (__NODE__ && !ctx.element) {\n            return next();\n          }\n\n          const markAsCritical = __NODE__\n            ? chunkId => {\n                // Push to legacy context for backwards compat w/ legacy SSR template\n                ctx.preloadChunks.push(chunkId);\n\n                // Also use new service if registered\n                if (criticalChunkIds) {\n                  let chunkIds = criticalChunkIds.from(ctx);\n                  chunkIds.add(chunkId);\n                }\n              }\n            : noop;\n          ctx.element = (\n            <PrepareProvider markAsCritical={markAsCritical}>\n              {ctx.element}\n            </PrepareProvider>\n          );\n          return next();\n        };\n      },\n    });\n    super(root, renderer);\n    registerInjector(this);\n  }\n}\n\nexport {ProviderPlugin, ProvidedHOC, Provider, withServices};\n\nfunction noop() {}\n\nexport * from './async/index.js';\n"],"names":["REACT_PREPARE","prepared","sideEffect","opts","OriginalComponent","Object","assign","boundary","defer","componentDidMount","componentWillReceiveProps","componentDidUpdate","contextTypes","forceUpdate","prep","prepare","Promise","resolve","PreparedComponent","props","context","then","UNSAFE_componentWillReceiveProps","nextProps","nextContext","render","React.createElement","React","displayName","name","isPrepared","CustomComponent","getPrepare","storeShape","PropTypes","shape","dispatch","func","isRequired","dispatched","prepareUsingDispatch","store","preparedOpts","isReactCompositeComponent","type","Function","prototype","isReactFunctionalComponent","renderCompositeElementInstance","instance","childContext","getChildContext","constructor","getDerivedStateFromProps","state","componentWillMount","UNSAFE_componentWillMount","children","prepareComponentInstance","prepareConfig","prepareElement","element","isContextConsumer","_currentValue","isContextProvider","_context","value","isFragment","isForwardRef","CompositeComponent","isPortal","TypeError","JSON","stringify","_prepare","all","toArray","map","child","__IS_PREPARE__","CHUNKS_KEY","splitComponentLoaders","array","withAsyncComponent","load","LoadingComponent","ErrorComponent","AsyncComponent","error","chunkIds","WithAsyncComponent","componentPromise","e","reject","loadPromises","loader","asyncComponent","default","undefined","Error","catch","err","setTimeout","PrepareProvider","markAsCritical","only","childContextTypes","middleware","ctx","next","console","warn","noop","prepareTyped","preparedTyped","splitTyped","split","excludeTyped","exclude","createContext","key","Math","random","Provider","any","Consumer","InjectorContext","getServices","app","deps","services","entries","forEach","token","getService","defaultInject","defaultMap","registerInjector","inject","renderProvider","injectorPlugin","createPlugin","register","withServices","mapServicesToProps","serviceProps","renderConsumer","Component","WithServices","el","domElement","document","getElementById","ReactDOM","hydrate","create","provides","replace","c","toUpperCase","plugin","provider","__plugin__","originalMiddleware","ProviderComponent","nextMiddleware","mw","mapProvidesToProps","mapProvides","HOC","App","root","renderer","criticalChunkIds","CriticalChunkIdsToken","optional","clientRender","FusionApp"],"mappings":"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"}